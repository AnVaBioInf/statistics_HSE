# -*- coding: utf-8 -*-
"""HW3_statistics.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1x1HvBuwTe7pGqMzXKOY0Lb4KnXpUvggc

https://www.kaggle.com/shivan118/heart-diseases-exploration

https://www.kaggle.com/mehmetsahingil/water-quality-explanatory-data-analysis

Здесь описание колонок \\
Age \\
Number of sexual partners \\
First sexual intercourse \\
Num of pregnancies	\\
'Smokes', \\
'Smokes (years)', \\
'Smokes (packs/year)', \\
'Hormonal Contraceptives', \\
'Hormonal Contraceptives (years)', \\
'IUD', - внутриматочная спираль \\
'IUD (years)', \\
'STDs', Sexually Transmitted Diseases  - Заболевания передающиеся половым путем \\
'STDs (number)', \\
'STDs:condylomatosis', - кондиломатоз \\
'STDs:cervical condylomatosis', \\
'STDs:vaginal condylomatosis', \\
'STDs:vulvo-perineal condylomatosis', \\
'STDs:syphilis', \\
'STDs:pelvic inflammatory disease', \\
'STDs:genital herpes', \\
'STDs:molluscum contagiosum', \\
'STDs:AIDS', \\
'STDs:HIV', \\
'STDs:Hepatitis B', \\
'STDs:HPV', вирус паппиломы человека \\
'STDs: Number of diagnosis', \\
'STDs: Time since first diagnosis', \\
'STDs: Time since last diagnosis', \\

Dx: Abbreviation for diagnosis, the determination of the nature of a disease.
'Dx:Cancer', \\
'Dx:CIN', Another name for cervical dysplasia is cervical intraepithelial neoplasia, or CIN \\
'Dx:HPV', Вирус папилломы человека (ВПЧ) \\
'Dx', ???????????????????????\\

'Hinselmann', Hinselmann is a test method for cervical cancer by examining the cells on an instrument called colposcope. \\
'Schiller', Schiller's test or Schiller's Iodine test is a medical test in which iodine solution is applied to the cervix in order to diagnose cervical cancer \\
'Citology', цитология \\
'Biopsy' биопися \\
https://aip.scitation.org/doi/pdf/10.1063/1.5132472#:~:text=Hinselmann%20is%20a%20test%20method,applied%20iodine%20to%20the%20cervix.

План эксперимента

Description
Cervical Cancer Risk Factors for Biopsy: This Dataset is Obtained from UCI Repository and kindly acknowledged!

This file contains a List of Risk Factors for Cervical Cancer leading to a Biopsy Examination!

About 11,000 new cases of invasive cervical cancer are diagnosed each year in the U.S. However, the number of new cervical cancer cases has been declining steadily over the past decades. Although it is the most preventable type of cancer, each year cervical cancer kills about 4,000 women in the U.S. and about 300,000 women worldwide. In the United States, cervical cancer mortality rates plunged by 74% from 1955 - 1992 thanks to increased screening and early detection with the Pap test. AGE Fifty percent of cervical cancer diagnoses occur in women ages 35 - 54, and about 20% occur in women over 65 years of age. The median age of diagnosis is 48 years. About 15% of women develop cervical cancer between the ages of 20 - 30. Cervical cancer is extremely rare in women younger than age 20. However, many young women become infected with multiple types of human papilloma virus, which then can increase their risk of getting cervical cancer in the future. Young women with early abnormal changes who do not have regular examinations are at high risk for localized cancer by the time they are age 40, and for invasive cancer by age 50. SOCIOECONOMIC AND ETHNIC FACTORS Although the rate of cervical cancer has declined among both Caucasian and African-American women over the past decades, it remains much more prevalent in African-Americans -- whose death rates are twice as high as Caucasian women. Hispanic American women have more than twice the risk of invasive cervical cancer as Caucasian women, also due to a lower rate of screening. These differences, however, are almost certainly due to social and economic differences. Numerous studies report that high poverty levels are linked with low screening rates. In addition, lack of health insurance, limited transportation, and language difficulties hinder a poor woman’s access to screening services. HIGH SEXUAL ACTIVITY Human papilloma virus (HPV) is the main risk factor for cervical cancer. In adults, the most important risk factor for HPV is sexual activity with an infected person. Women most at risk for cervical cancer are those with a history of multiple sexual partners, sexual intercourse at age 17 years or younger, or both. A woman who has never been sexually active has a very low risk for developing cervical cancer. Sexual activity with multiple partners increases the likelihood of many other sexually transmitted infections (chlamydia, gonorrhea, syphilis).Studies have found an association between chlamydia and cervical cancer risk, including the possibility that chlamydia may prolong HPV infection. FAMILY HISTORY Women have a higher risk of cervical cancer if they have a first-degree relative (mother, sister) who has had cervical cancer. USE OF ORAL CONTRACEPTIVES Studies have reported a strong association between cervical cancer and long-term use of oral contraception (OC). Women who take birth control pills for more than 5 - 10 years appear to have a much higher risk HPV infection (up to four times higher) than those who do not use OCs. (Women taking OCs for fewer than 5 years do not have a significantly higher risk.) The reasons for this risk from OC use are not entirely clear. Women who use OCs may be less likely to use a diaphragm, condoms, or other methods that offer some protection against sexual transmitted diseases, including HPV. Some research also suggests that the hormones in OCs might help the virus enter the genetic material of cervical cells. HAVING MANY CHILDREN Studies indicate that having many children increases the risk for developing cervical cancer, particularly in women infected with HPV. SMOKING Smoking is associated with a higher risk for precancerous changes (dysplasia) in the cervix and for progression to invasive cervical cancer, especially for women infected with HPV. IMMUNOSUPPRESSION Women with weak immune systems, (such as those with HIV / AIDS), are more susceptible to acquiring HPV. Immunocompromised patients are also at higher risk for having cervical precancer develop rapidly into invasive cancer. DIETHYLSTILBESTROL (DES) From 1938 - 1971, diethylstilbestrol (DES), an estrogen-related drug, was widely prescribed to pregnant women to help prevent miscarriages. The daughters of these women face a higher risk for cervical cancer. DES is no longer prsecribed.

Цель - установить, какие факторы влияют на развитие рака шейки матки? \\
Диагностика?
"""

# importing libraries
import pandas as pd
import numpy as np
import scipy.stats as stats
import matplotlib.pyplot as plt
import seaborn as sns
from math import sqrt

df = pd.read_csv('kag_risk_factors_cervical_cancer.csv')

df[df['Dx:HPV']==1]

"""Связь Hinselmann	Schiller	Citology	Biopsy с диагнозом, диагнозом рака. Наиболее эффективный? Почитать про эти методы \\
Связь курения с раком \\

Связь первого сексуального контакта с заражением HPV

## Общий анализ данных
"""

print(df.shape)

col = df.columns
col

"""Строки в которых встречается ?"""

l = []
for i in df:
  if df[df[i]=='?'].empty:
    pass
  else:
    l.append(i)

for i in l:
  df.replace({i: {'?': np.nan}}, regex=False,inplace=True)
df.isnull().sum()

df.info()

"""Выкинуть колонки с большим количеством NA?"""

num = ['Age', 'Number of sexual partners', 'First sexual intercourse',
       'Num of pregnancies', 'Smokes (years)', 'Smokes (packs/year)',
       'Hormonal Contraceptives (years)', 'IUD (years)', 'STDs (number)', 
       'STDs: Number of diagnosis', 'STDs: Time since first diagnosis', 
       'STDs: Time since last diagnosis']

for i in col:
  df[i] = pd.to_numeric(df[i])

for i in col.difference(num):
  df[i]=df[i].map({1: True, 0: False})
#  if col[i] not in num == TRUE:
#    print(col[i])

df

df.info()

df.describe()

df.hist(bins=40, figsize=(12,12))

df.skew()

corr_matrix = df.corr()
corr_matrix

import seaborn as sns

plt.figure(figsize=(20,20))
sns.heatmap(corr_matrix,cmap='YlGnBu',annot=True);

"""Контроцептивы и число выявленных случаев рака"""

plt.scatter(x, df[], s=area, c=colors, alpha=0.5)
plt.show()

# Commented out IPython magic to ensure Python compatibility.
# %config InlineBackend.figure_format = 'png'
sns.pairplot(df)

"""## Хараетеристика пациенток с раком шейки матки


"""

# Разделим базу данных пациентов на пациентов с диагнозом РШМ и без
df_dx_cancer = df[df['Dx:Cancer']==True]
df_dx_no_cancer = df[df['Dx:Cancer']==False]

df_dx_cancer

"""Взять всех пациенток и просуммировать по годам новые диагнозы? Нельзя? Нет информации о дате первичного диагноза?"""

df_dx_cancer.shape

df_dx_cancer.describe()

"""## Гипотезы. Качественные параметры

AIDS выкинуть? Пациентов с ним нет? или это неправильно?
"""

from scipy import stats

# STDs - sexually transmitted disease
# Dx - diognosis
### Что с этим делать????
par = ['Smokes', 'Hormonal Contraceptives', 'IUD', 'STDs', 'STDs:condylomatosis',
       'STDs:cervical condylomatosis', 'STDs:vaginal condylomatosis',
       'STDs:vulvo-perineal condylomatosis', 'STDs:syphilis',
       'STDs:pelvic inflammatory disease', 'STDs:genital herpes',
       'STDs:molluscum contagiosum', 'STDs:AIDS', 'STDs:HIV',
       'STDs:Hepatitis B', 'STDs:HPV', 'STDs: Number of diagnosis', 
        'Dx:CIN', 'Dx:HPV']

for i in par:
  i_cancer = len(df[(df[i] == True) & (df['Dx:Cancer'] == True)].index)
  i_no_cancer = len(df[(df[i] == True) & (df['Dx:Cancer'] == False)].index)
  no_i_cancer = len(df[(df[i] == False) & (df['Dx:Cancer'] == True)].index)
  no_i_no_cancer = len(df[(df[i] == False) & (df['Dx:Cancer'] == False)].index)

  df_smokers_and_cancer = {'':[i, ('no '+i)], 
          'Cancer':[i_cancer,no_i_cancer], 
          'No_cancer':[i_no_cancer,no_i_no_cancer]}
  df_smokers_and_cancer = pd.DataFrame(df_smokers_and_cancer)  

# КРИТЕРИИ
# точный тест Фишера
  oddsratio, pvalue = stats.fisher_exact([[i_cancer,i_no_cancer], [no_i_cancer,no_i_no_cancer]], alternative='two-sided')
  print(df_smokers_and_cancer, '\n')

# Сравнение чисел событий
  if all(i>5 for i in [i_cancer, i_no_cancer, no_i_cancer, no_i_no_cancer])==True:
    # 1 эксп: n успехов из N независимых испытаний
    # 2 эксп: m успехов из M независимых испытаний
    # успех-диагноз=рак
    #   p = (n + m)/(N + M) =
    N = i_cancer + i_no_cancer
    M = no_i_cancer + no_i_no_cancer
    n = i_cancer
    m = no_i_cancer
    p = (n + m)/(N + M)
    D1 = p*(1-p)/N
    D2 = p*(1-p)/M
    Z = (n/N-m/M)/(D1 + D2)**0.5
    print(Z< -1.96,'\n')

"""Возможно применить: \\
точный тест Фишера \\
Сравнение чисел событий (условие: все больше 5 и не более одного меньше 10)

### Гипотеза 2 - курение повышает риск заболевания раком

H0 - курение не влияет на заболеваемость раком \\
H1 - курение влияет (повышает) заболеваемость раком
односторонняя или двусторонняя?

Критерий фишера?
"""

smoke_cancer = len(df[(df['Smokes'] == True) & (df['Dx:Cancer'] == True)].index)
smoke_no_cancer = len(df[(df['Smokes'] == True) & (df['Dx:Cancer'] == False)].index)
dont_smoke_cancer = len(df[(df['Smokes'] == False) & (df['Dx:Cancer'] == True)].index)
dont_smoke_no_cancer = len(df[(df['Smokes'] == False) & (df['Dx:Cancer'] == False)].index)

"""Cтроим таблицу сопряженности"""

df_smokers_and_cancer = {'':['Numb_of_smoking', 'Numb_of_non_smoking'], 
        'Cancer':[smoke_cancer,dont_smoke_cancer], 
        'No_cancer':[smoke_no_cancer,dont_smoke_no_cancer]}
df_smokers_and_cancer = pd.DataFrame(df_smokers_and_cancer)  

df_smokers_and_cancer

"""Критерий Фишера применить нельзя. У нас есть 1 значение меньше 5.

Односторонний? Мы изначально предполагаем, что курение может приводить к раку

Точный тест Фишера
"""

from scipy import stats
oddsratio, pvalue = stats.fisher_exact([[2,121], [15,707]], alternative='two-sided')
pvalue

"""## Гипотезы, количественные"""

quant_par = ['Age', 'Number of sexual partners', 'First sexual intercourse',
       'Num of pregnancies', 'Smokes (years)', 'Smokes (packs/year)',
       'Hormonal Contraceptives (years)', 'IUD (years)', 'STDs (number)', 
       'STDs: Number of diagnosis']
for i in quant_par:
  fig = plt.figure(figsize=(5,5)) 
  ax = fig.gca()
  ax = sns.boxplot(data=[df_dx_cancer[i], df_dx_no_cancer[i]])

"""### Гипотеза - Гормональные контрацептивы увеличивают риск заболевания РШМ"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['Hormonal Contraceptives (years)'], df_dx_no_cancer['Hormonal Contraceptives (years)']])



"""### Гипотеза - внутриматочная спираль повышает риск развития РШМ

### Гипотеза 1 - средний возраст пациенток с раком и без рака отличается \\
Связь с возрастом - экспоненциальное распределение?
Не можем проверить! Нет даты постановки диагноза!!!
"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['Age'], df_dx_no_cancer['Age']])
#plt.yscale('log')

"""#### H0 - возраст не зависит на заболеваемость раком (когда был впервые диагностирован рак?????
H1 - возраст влияет на заболеваемость раком

### Гипотеза Заболевания передающиеся половым путем увеличивают риск развития РШМ

### Гипотеза 'STDs:condylomatosis', - кондиломатоз повышает риск развития РШМ

### Гипотеза 'STDs:cervical condylomatosis' повышает риск развития РШМ

### Гипотеза 'STDs:vaginal condylomatosis' повышает риск развития РШМ

### Гипотеза 'STDs:vulvo-perineal condylomatosis' повышает риск развития РШМ

### Гипотеза 'STDs:syphilis' повышает риск развития РШМ

### Гипотеза 'STDs:pelvic inflammatory disease' повышает риск развития РШМ

### Гипотеза 'STDs:genital herpes' повышает риск развития РШМ

### Гипотеза 'STDs:molluscum contagiosum' повышает риск развития РШМ

### Гипотеза 'STDs:AIDS' повышает риск развития РШМ

### Гипотеза 'STDs:HIV' повышает риск развития РШМ

### Гипотеза 'STDs:Hepatitis B' повышает риск развития РШМ

### Гипотеза 'STDs:HPV', вирус паппиломы человека повышает риск развития РШМ

## Гипотезы. Количественные параметры

Нормализовать данные перед тем, как строить гисторамму?

### Cреди тех, кто курит? Так можно?

Проверить корреляцию между количеством выкренных пачек и...?

### 'Smokes (years)',
"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['Smokes (years)'], df_dx_no_cancer['Smokes (years)']])
#plt.yscale('log')

"""### 'Smokes (packs/year)',"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['Smokes (packs/year)'], df_dx_no_cancer['Smokes (packs/year)']])
#plt.yscale('log')

"""### 'Hormonal Contraceptives (years)'"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['Hormonal Contraceptives (years)'], df_dx_no_cancer['Hormonal Contraceptives (years)']])
#plt.yscale('log')

"""### 'IUD (years)'"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['IUD (years)'], df_dx_no_cancer['IUD (years)']])
#plt.yscale('log')

"""### Гипотеза Число беременностей связано с развитием РШМ"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['Num of pregnancies'], df_dx_no_cancer['Num of pregnancies']])
#plt.yscale('log')

"""### Гипотеза - Ранняя полова жизнь приводит к развитию РШМ?"""

fig = plt.figure(figsize=(5,5)) 
ax = fig.gca()
ax = sns.boxplot(data=[df_dx_cancer['First sexual intercourse'], df_dx_no_cancer['First sexual intercourse']])
#plt.yscale('log')

"""## Диагностика? Как коррелируют между собой диагностические методы?

'Hinselmann', Hinselmann is a test method for cervical cancer by examining the cells on an instrument called colposcope.
'Schiller', Schiller's test or Schiller's Iodine test is a medical test in which iodine solution is applied to the cervix in order to diagnose cervical cancer
'Citology', цитология
'Biopsy' биопися

### .

'STDs (number)',

'STDs: Number of diagnosis',
'STDs: Time since first diagnosis',
'STDs: Time since last diagnosis',

Dx: Abbreviation for diagnosis, the determination of the nature of a disease. 'Dx:Cancer',
'Dx:CIN', Another name for cervical dysplasia is cervical intraepithelial neoplasia, or CIN
'Dx:HPV', Вирус папилломы человека (ВПЧ)
'Dx', ???????????????????????\

'Hinselmann', Hinselmann is a test method for cervical cancer by examining the cells on an instrument called colposcope.
'Schiller', Schiller's test or Schiller's Iodine test is a medical test in which iodine solution is applied to the cervix in order to diagnose cervical cancer
'Citology', цитология
'Biopsy' биопися

Посмотреть от чего зависят факторы от которых зависит РШМ?

### Корреляция
"""